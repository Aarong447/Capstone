(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1042:function(e,t,n){"use strict";function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"*";try{const o=e.slice(e.length-t);return n.repeat(e.length-t)+o}catch(t){return null!=e?e:""}}function l(data){return{cardNumber:r(data.cardNumberLengths),pin:r(data.pinLengths)}}n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return l}));const r=e=>"^(".concat(e.map((e=>"\\d{".concat(e,"}"))).join("|"),")$")},1164:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));n(6),n(15);var o=n(265),l=n(1014);const r=function(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{localeCode:"en-US",localeMapping:'{"en-us":"en_US"}'};if(!t)return"";try{const[o,l]=t.split(","),r=new Date(null!=l?l:o);if(e=new Date(r.valueOf()+60*r.getTimezoneOffset()*1e3),!n)return t}catch(e){return t}const[v,m]=["{{","}}"],y=n.lastIndexOf(v),h=n.indexOf(m,y+v.length);if(-1===y||-1===h)return n;const P=n.substring(y+v.length,h),A="".concat(v+P+m);try{const t=/( )(\d+)/,r=Object(l.a)(null==c?void 0:c.localeCode,null==c?void 0:c.localeMapping),v=Object(o.a)(e,P,{...r&&{locale:r}});return n.replace(A,v.replace(t,"".concat(d?"&nbsp;":" ","$2")))}catch(e){return r?n.replace(A,t):t}}},2244:function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));n(15);var o=n(11),l=n(1),r=n(164),d=n(32),c=n(16),v=n(347),m=n(133),y=n(1042),h=n(12),P=n(89),A=n(154),C=n(30),f=n(1164);const w=(e,t)=>{var n,w;const{getCartPaymentInstruments:S,getPaymentSession:T,getProvinceList:L}=Object(h.b)(e),_=Object(o.a)(e,"useApplePay-".concat(t)),O=null!==(n=_.get("paymentRequest"))&&void 0!==n?n:_.save("paymentRequest",Object(l.ref)({})),E=null!==(w=_.get("postalCodeValidationRegex"))&&void 0!==w?w:_.save("postalCodeValidationRegex",Object(l.ref)(null));let I;t===m.a.PDP&&(I=t);const{localeCode:D,localeMapping:R}=Object(c.a)(e),U={localeCode:D(),localeMapping:R()},{cart:N,shippingGroups:j,setShippingMethod:M,getShippingMethods:k,hasPickupItems:x,addItem:F}=I?Object(d.a)(e):Object(d.b)(e),{shippingAddress:$,billingAddress:V,setShippingAddress:Y,saveShippingAddress:B,saveBillingAddress:J,paymentMethod:z,placeOrder:G,applePayOrderToken:W}=Object(r.a)(e,I),{defaultCurrency:X}=Object(c.a)(e),{getCountry:H}=Object(v.a)(e),{ensureAccessTokenIsPresentAndProcess:K}=Object(C.a)(e),{addNotification:Q}=Object(A.a)(e),Z=Object(l.ref)(null),ee=e.$getEnvValueByCurrentLocale("APPLE_PAY_CONF"),te=()=>"undefined"!=typeof ApplePaySession,ne=async()=>{var t;try{Z.value=await K((()=>L(H(),e.$i18n.locale,{preview:e.context.$isPreview})))||null,E.value=(null===(t=null==Z?void 0:Z.value.data)||void 0===t?void 0:t.postCodeRegEx)||null}catch(e){Z.value=null,E.value=null}},ie=async address=>{var t,n,o;let l=null===(n=null===(t=Z.value)||void 0===t?void 0:t.data)||void 0===n?void 0:n.provinces;if(address.countryCode!==H().toLocaleUpperCase())try{if(l=await K((()=>L(address.countryCode,e.$i18n.locale,{preview:e.context.$isPreview})))||null,!(null==l?void 0:l.length))return!0}catch(e){return!0}return!(!address.province||!(null===(o=null==l?void 0:l.map((e=>e.code)))||void 0===o?void 0:o.includes(address.province)))||(Q({message:"",type:"danger"}),!1)},ae=()=>{var e,t;return te()&&!x.value&&!(null===(t=null===(e=N.value)||void 0===e?void 0:e.items)||void 0===t?void 0:t.some((e=>!!(e.customsRecipeID||e.recipe||e.recipeId))))},oe=data=>{O.value={...O.value,...data}},le=e=>{var t,n,o;return void 0!==e.upsell?(null===(t=null==e?void 0:e.price)||void 0===t?void 0:t.current)||0:(null===(o=null===(n=null==e?void 0:e.variant)||void 0===n?void 0:n.price)||void 0===o?void 0:o.current)||0},re=e=>[].concat(e).reduce(((e,t)=>e+le(t)),0).toFixed(2),se=(e,t)=>{let n=N.value.totals.remainingToPay||N.value.totals.total;return!parseInt(String(n))&&t&&(n=re(t)),{label:e.total,amount:String(n),type:"final"}},de=(e,t)=>{var n;let o=0;!N.value.totals.itemTotal&&t&&(o=re(t));const l=[{label:e.subtotal,amount:""+(N.value.totals.itemTotal||o),type:"final"},{label:e.tax,amount:""+N.value.totals.tax},{label:e.shipping,amount:""+N.value.totals.shipping}];return N.value.totals.totalDiscount&&l.push({label:e.discount,amount:""+N.value.totals.totalDiscount}),null===(n=N.value.payment_instruments)||void 0===n||n.forEach((t=>{t.payment_method_id===P.b.GIFT_CARD&&l.push({label:"".concat(e.giftCard," - ").concat(Object(y.b)(t.c_gcCardNumber)),amount:"-"+t.amount})})),l},ue=e=>j.value.reduce(((t,n)=>{if("me"===n.shippingId)return t.concat(n.methods.map((t=>({label:t.label,amount:""+t.price.finalAmount,detail:Object(f.a)(t.deliveryTime,e.deliveryDateLabel,!1,!1,U)||"",identifier:t.code}))).sort((a=>a.identifier===n.code?-1:0)))}),[]),pe=function(t){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2?arguments[2]:void 0;oe({countryCode:e.$getEnvValueByCurrentLocale("COUNTRY").toUpperCase(),currencyCode:N.value.currency||X.value,shippingContactEditingMode:"enabled",lineItems:de(t,o),merchantCapabilities:(null==ee?void 0:ee.merchant_capabilities)||[],supportedNetworks:(null==ee?void 0:ee.supported_networks)||[],requiredBillingContactFields:(null==ee?void 0:ee.required_billing_contact_fields)||[],requiredShippingContactFields:(null==ee?void 0:ee.required_shipping_contact_fields)||[],total:se(t,o),shippingType:"shipping",shippingMethods:ue(t),shippingContact:n?ve():void 0})},ce=address=>{var e,t,n,o,l;return[{firstName:(null==address?void 0:address.givenName)||"",lastName:(null==address?void 0:address.familyName)||"",email:(null==address?void 0:address.emailAddress)||"",country:(null==address?void 0:address.countryCode)||"",addressLine1:(null===(e=null==address?void 0:address.addressLines)||void 0===e?void 0:e[0])||"",addressLine2:(null===(t=null==address?void 0:address.addressLines)||void 0===t?void 0:t[1])||"",postalCode:(null==address?void 0:address.postalCode)||"",city:(null==address?void 0:address.locality)||"",province:(null===(n=null==address?void 0:address.administrativeArea)||void 0===n?void 0:n.toUpperCase())||"",phone:(null==address?void 0:address.phoneNumber)||"",stateCode:(null===(o=null==address?void 0:address.administrativeArea)||void 0===o?void 0:o.toUpperCase())||"",countryCode:(null===(l=null==address?void 0:address.countryCode)||void 0===l?void 0:l.toUpperCase())||""}]},ve=()=>{const e=N.value.shippingMethods[0].address,t=[e.addressLine1];return void 0!==e.addressLine2&&t.push(e.addressLine2),{addressLines:t,locality:e.city,administrativeArea:e.province||e.stateCode,postalCode:e.postalCode,countryCode:e.countryCode||e.country,familyName:e.lastName,givenName:e.firstName,emailAddress:e.email,phoneNumber:e.phone}};return{paymentRequestData:Object(l.computed)((()=>O.value)),isApplePayAvailable:ae,isApplePayApiDefined:te,isProvinceValid:ie,initApplePaySession:function(n,o){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;const d=[];if([m.a.PDP,m.a.CART].includes(t)&&d.push("context=".concat(P.b.APPLE_PAY_EXPRESS)),!ae())return void o();pe(n,l,r);const c=new ApplePaySession(10,O.value);return c.onshippingmethodselected=async e=>{const o=e.shippingMethod;await M({code:o.identifier,shippingId:"me",isTemporary:t===m.a.PDP,shopperAppliedSM:!0}),c.completeShippingMethodSelection({newTotal:se(n),newLineItems:de(n)})},c.onshippingcontactselected=async e=>{await ne(),B(ce(null==e?void 0:e.shippingContact)[0]),await Y(ce(null==e?void 0:e.shippingContact),{updateCartData:!0,isTemporary:t===m.a.PDP},d),await k("me",{isBackgroundRequest:!1,isTemporary:t===m.a.PDP}),c.completeShippingContactSelection({newTotal:se(n),newLineItems:de(n),newShippingMethods:ue(n)})},c.onvalidatemerchant=async()=>{const t=e.$getDomainName().replace(/(^\w+:|^)\/\//,""),l=await K((()=>T(t,"",P.b.APPLEPAY,{preview:e.context.$isPreview})));if(o(),r){if(!await F(r,{isTemporary:!0}))return c.completeMerchantValidation({status:ApplePaySession.STATUS_FAILURE,errors:[new ApplePayError("unknown")]});pe(n,!1)}E.value||ne(),c.completeMerchantValidation(l.data.meta.merchantSession)},c.onpaymentauthorized=async n=>{var o,l,r,v,y,h,A,C,f,w,T,L;if(E.value&&!(null===(r=null===(l=null===(o=null==n?void 0:n.payment)||void 0===o?void 0:o.shippingContact)||void 0===l?void 0:l.postalCode)||void 0===r?void 0:r.match(E.value)))return c.completePayment({status:ApplePaySession.STATUS_FAILURE,errors:[new ApplePayError("shippingContactInvalid","postalCode")]});let _=!1;try{if(t===m.a.PDP)_=!0;else{_=!!(null===(v=(await K((()=>S({cartId:N.value.id,payment_method_id:P.b.APPLEPAY},{preview:e.context.$isPreview})))).data.payment_instruments)||void 0===v?void 0:v.find((e=>e.payment_method_id===P.b.APPLEPAY)))}if(_){await ne(),W.value=JSON.stringify({payment:{token:n.payment.token}}),B(ce(null===(y=null==n?void 0:n.payment)||void 0===y?void 0:y.shippingContact)[0]),await Y(ce(null===(h=null==n?void 0:n.payment)||void 0===h?void 0:h.shippingContact),{updateCartData:!1,isTemporary:t===m.a.PDP},d),J(ce({...null===(A=null==n?void 0:n.payment)||void 0===A?void 0:A.billingContact,emailAddress:null===(f=null===(C=null==n?void 0:n.payment)||void 0===C?void 0:C.shippingContact)||void 0===f?void 0:f.emailAddress,phoneNumber:null===(T=null===(w=null==n?void 0:n.payment)||void 0===w?void 0:w.shippingContact)||void 0===T?void 0:T.phoneNumber})[0]),z.value=P.b.APPLEPAY;const e=await ie($.value),o=await ie(V.value);if(!e||!o)return void c.completePayment({status:ApplePaySession.STATUS_FAILURE,errors:[new ApplePayError("addressInvalid","province","Province is invalid")]});const l=await G({isTemporary:t===m.a.PDP});if(l&&!1===l.success){const e=null===(L=l.errors)||void 0===L?void 0:L.find((e=>{var t;return null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.includes("billingAddress")}));c.completePayment({status:ApplePaySession.STATUS_FAILURE,errors:[new ApplePayError(e?"billingContactInvalid":"unknown")]})}else c.completePayment({status:ApplePaySession.STATUS_SUCCESS})}else c.completePayment({status:ApplePaySession.STATUS_FAILURE,errors:[new ApplePayError("unknown")]})}catch(e){c.completePayment({status:ApplePaySession.STATUS_FAILURE,errors:[new ApplePayError("unknown")]})}finally{W.value=""}},c.oncancel=e=>{console.error("Apple Pay session canceled: "+e),o()},c.begin(),c},updatePaymentRequest:oe,refreshPaymentRequestWithCurrentCartData:pe,mapAddressData:ce,mapCartShippingAddressToApplePay:ve,postalCodeValidationRegex:E,getProvinceListResponse:Z,getProductPriceValue:le,getValueOfProductsToBeAdded:re,getProvinceList:ne}}}}]);
//# sourceMappingURL=d3ae086.js.map